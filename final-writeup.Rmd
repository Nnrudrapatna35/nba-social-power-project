---
title: "Final Writeup"
author: "Pipe It Up!: Nagaprasad Rudrapatna, Karen Deng, Jackson Muraika, Anna Zolotor"
date: "`r Sys.Date()`"
output: 
  pdf_document:
    fig_width: 3
    fig_height: 3
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE)
```

```{r load-packages, message = FALSE}
# devtools::install_github('rstudio/rmarkdown') use this if you have trouble knitting
library(tidyverse)
library(broom)
library(stringr)
library(knitr)
library(patchwork)
library(leaps)
library(rms)
```

```{r load-data, message = FALSE}
nba_social_power <- read_csv("data/nba.csv")

nba_2016_2017_100 <- nba_social_power

nba_social_power_mod <- nba_social_power %>%
  filter(TWITTER_HANDLE != "0") %>%
  select(PLAYER_NAME, 
         TEAM_ABBREVIATION,
         AGE,
         W_PCT,
         OFF_RATING,
         DEF_RATING,
         AST_RATIO,
         REB_PCT,
         USG_PCT,
         PIE,
         SALARY_MILLIONS,
         ACTIVE_TWITTER_LAST_YEAR,
         TWITTER_FOLLOWER_COUNT_MILLIONS,
         PTS,
         FGM,
         FGA) 
```

### Section 1: Introduction

In this project, Pipe it Up has used the Kaggle dataset "Social Power NBA" to explore the following research question:  Is there a relationship between measures of basketball success (such as win percentage and offensive/defensive ratings) and Internet popularity, measured in number of Twitter followers? The motivation for this analysis stems from the increasing relevance of social media in today’s hyperconnected world.
Social media provides a platform for people to share stories and opinions, and influential people, especially
athletes, have considerable sway over large segments of the population. Additionally, since the NBA is a
star-driven league due to its small team size and worldwide recognition, social media presence is significant
for basketball players. The original creator of our Kaggle dataset, UC Davis and Northwestern professor
Noah Gift, conducted analyses to determine which factors relating to basketball success social media and
internet popularity could accurately predict. He searched for correlation between those factors and a number
of response variables, including arena attendance, endorsements, salary, and NBA performance. Our team
was fascinated by the statistician’s conclusions, but we wanted to take the reverse approach and determine
which factors (relating to basketball success) can predict the social media popularity that he claims is so
important.

Our dataset includes on-court performance data for NBA players in the 2016-2017 season,
along with their salary and Twitter engagement. Because we are examining the relationship between player statistics and the number of Twitter followers, we decided to only consider players who had a Twitter account, by filtering for values where TWITTER_HANDLE is not 0 (NA). After filtering, we had 95 observations (we later removed one more observation because it influenced the regression line, leaving us with 94). Twitter followers was our response variable, and we chose to include 16 explanatory variables: player name, player age, team name abbreviation, win percentage, offensive rating, defensive rating, field goals made, field goals attempted, assist to turnover ratio, rebound percentage, usage percentage, player impact factor (a measure of the impact the player has on games), salary in millions of dollars, whether they were active on Twitter last year, and points scored per game.

A few intereting/ important points from our exploratory data analysis will be shown here, but the complete EDA can be found in additional analysis. 

The distribution of Twitter follower count is shown here: 

```{r fig.width= 4, fig.height = 4}
ggplot(data = nba_social_power_mod,
       aes(x= TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_histogram(binwidth = 2) +
  labs(x = "Twitter Followers, in Millions",
       y = "Count",
       title = "Distribution of Twitter Follower Counts")
```

From the histogram, we can see that the distribution of Twitter follower counts is extremely right-skewed. The number of Twitter followers ranges from .002 million to 37 million, with a mean of 1.6 million and a median of.246 million. There are two obvious outliers: Kevin Durant, with 16.2 million followers, and LeBron James, with 37 million followers. 

Now, I'll include several of the bivariate plots that showed particularly interesting or stronger correlations between the explanatory variable and the response. Below, we can see scatterplots displaying the relationships between player salaries and Twitter follower count, average points scored in a game and Twitter follower count, and player impact factor and Twitter follower count. 

```{r}
p1 <- ggplot(nba_social_power_mod, aes(x = SALARY_MILLIONS, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Player Salaries vs Twitter Count",
       x = "Salary, in Millions of Dollars",
       y = "Twitter Follower Count, Millions")

p2 <- ggplot(nba_social_power_mod,
       aes(x = PTS, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Avg. Points Scored vs Twitter Count",
       x = "Avg. Points Scored",
       y = "Twitter Follower Count, Millions")

p3 <- ggplot(nba_social_power_mod, 
       aes(x = PIE, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Player Impact Factor vs Twitter Count",
       x = "Player Impact Factor",
       y = "Twitter Follower Count, Millions")
```

```{r}
p1 + p2 + p3 + plot_layout (ncol = 2)
```

These were three of the bivariate relationships that appeared to be particularly telling about what the model would look like; all three show weak positive correlations between the explanatory and response variables. None of the bivariate plots showed a strong or very linear relationship between the explanatory variable and Twitter follower count. 

use patchwork for plots
remember no variable names in narrative (use actual terms)
added FGM and FGA (field goals made/attempted)
removed NETRATING



### Section 2: Regression Analysis

```{r}
nba_social_power_mod <- nba_social_power_mod %>%
  mutate(ageCent = AGE - mean(AGE),
         ast_ratioCent = AST_RATIO - mean(AST_RATIO),
         off_ratingCent = OFF_RATING - mean(OFF_RATING),
         def_ratingCent = DEF_RATING - mean(DEF_RATING),
         fgaCent = FGA - mean(FGA),
         fgmCent = FGM - mean(FGM),
         PIECent = PIE - mean(PIE),
         reb_pctCent = REB_PCT - mean(REB_PCT),
         usg_pctCent = USG_PCT - mean(USG_PCT),
         salary_millionsCent = SALARY_MILLIONS - mean(SALARY_MILLIONS),
         w_pctCent = W_PCT - mean(W_PCT),
         ptsCent = PTS - mean(PTS),
         active_twitter_lyear = as.factor(ACTIVE_TWITTER_LAST_YEAR))
```

#### Modeling Approach (all details included in Additional Analysis)

As our response, the number of Twitter followers (in millions), is a continuous numerical variable, we used a multiple linear regression model.

In regard to model selection, we began by fitting a multiple linear regression model with thirteen main effects (mean-centered age, mean-centered assists-to-turnovers ratio, mean-centered player offensive rating, mean-centered player defensive rating, mean-centered player impact factor (PIE), mean-centered rebound percentage, mean-centered usage percentage, mean-centered salary, mean-centered win percentage, mean-centered points scored, mean-centered field goals made, mean-centered field goals attempted, and whether the player has an active Twitter account in 2015-2016). We also considered interactions between mean-centered salary and mean-centered win percentage and mean-centered player impact factor (PIE) and mean-centered points scored because the multivariate EDA highlighted strong positive relationships between win percentage and player salary and points scored and PIE.

Next, we performed two iterations of backward selection on this initial model: (i) using AIC as the selection criterion and (ii) using adjusted R-squared as the selection criterion. We decided against trying BIC as the selection criterion because we would prefer more terms in the final model as our objective is to predict the Twitter follower counts of NBA players using measures of athletic success (and predictions are generally more accurate with more relevant predictor variables).

After completing the two iterations of backward selection, we compared the resulting models to see whether certain terms were removed in both (which would suggest those terms are not statistically significant). We also reconciled the differences between the terms included in the selected model based on one of the selection criterion but not the other. Particularly, mean-centered win percentage was included in the model selected based on AIC but not in the model selected based on adjusted R-squared. We decided to keep mean-centered win percentage in the model so that the statistically significant interaction between mean-centered salary and mean-centered win percentage could remain in the model as well.

Additionally, we closely examined the p-values and confidence intervals for each of the remaining predictors in the model after reconciling the differences between the models produced from the two iterations of backward selection. We noticed mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account had high p-values and confidence intervals including zero, suggesting they were statistically insignificant. We compared the AIC and adjusted R-squared values for the model selected based on AIC as the selection criterion (first iteration of backward selection) and the same model without mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016. The results were: the model with all terms maximized adjusted R-squared and minimized AIC. Since adjusted R-squared penalizes for unnecessary predictors, the fact that the model with all terms had a higher adjusted R-squared value means that, despite the high p-values and the presence of zero in the confidence intervals associated with mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016, these predictors are valuable in predicting the response, the number of Twitter followers (in millions). Hence, we decided to keep mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016 in the model.

Finally, we chose to analyze the impact of prominent athletes at the end of the model selection phase because prominent athletes are also included in the population we want to understand when fitting the multiple linear regression model (it is important to explore this topic since our objective is to design a model with the best predictive accuracy). We determined whether prominent athletes were influential points by looking at standardized residuals, leverage, and Cook's Distance. We identified LeBron James as an influential point in the data and decided to remove him to avoid overestimating the number of Twitter followers (in millions) for less prominent athletes.

However, as a result of this decision, the model coefficients changed considerably -- mean-centered field goals made and mean-centered field goals attempted became statistically insignificant. So, we conducted another iteration of backward selection using AIC as the selection criterion and eliminated mean-centered assists-to-turnovers ratio, mean-centered usage percentage, mean-centered field goals made, and mean-centered field goals attempted from the model. But, mean-centered age and whether the player had an active Twitter account in 2015-2016 -- insignificant predictors (based on p-values and confidence intervals) -- remained in the model. To determine whether these predictors should be removed, we compared the AIC and adjusted R-squared values for the final model selected based on AIC as the selection criterion (without LeBron) and the same model without mean-centered age and whether the player had an active Twitter account in 2015-2016. 

Based on the AIC and adjusted R-squared values, the model with all five terms minimized AIC and maximized adjusted R-squared. Therefore, we chose to move forward with the model which includes mean-centered salary, mean-centered win percentage, mean-centered age, whether the player had an active Twitter account in 2015-2016, and the interaction between mean-centered salary and mean-centered win percentage.

#### Final Model and Model Fit Statistics

Thus, our final model is:

```{r final-model}
nba_social_power_mod2 <- nba_social_power_mod %>%
  filter(PLAYER_NAME != "LeBron James")

m_final <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS ~
                 ageCent +
                 salary_millionsCent +
                 w_pctCent +
                 active_twitter_lyear +
                 salary_millionsCent * w_pctCent,
               data = nba_social_power_mod2)

tidy(m_final, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

To get a better sense of the model fit, we will calculate the R-squared and adjusted R-squared values:

```{r model-fit-statistics}
glance(m_final)$r.squared
glance(m_final)$adj.r.squared
```

The proportion of the variation in the number of Twitter followers (in millions) explained by the regression model is roughly 35.5%. Although this might suggest the model fit is relatively poor, it is important to remember we have removed many explanatory variables from the model so that predominantly significant variables remain (and R-squared increases as more explanatory variables are included). Since the adjusted R-squared value is close to the R-squared value, we conclude the variables in the model are significant in understanding variation in the number of Twitter followers (in millions).

#### Discussion of Assumptions

Next, we checked the linearity, constant variance, normality, and independence assumptions for multiple linear regression.

First, we checked whether the response, the number of Twitter followers (in millions), had a linear relationship with the predictor variables in the model by plotting the standardized residuals vs. predicted values:

```{r std-resid-vs-predicted-values}
m_final_aug <- augment(m_final)

ggplot(data = m_final_aug, aes(x = .fitted, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Predicted Values", y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Predicted Values")
```

The height of the cloud of points varies as you move from left to right. Points are clustered at the very left, but they are sparser as you move along the graph. Therefore, constant variance is not satisfied. 

There does not seem to be a systematic pattern in the plot of the standardized residuals vs. predicted values. Hence, this plot presents no issues with the linearity assumption. 

```{r std-resid-vs-predictors}
ggplot(data = m_final_aug, aes(x = salary_millionsCent, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Salary (Millions)", 
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Salary (Millions)")

ggplot(data = m_final_aug, aes(x = w_pctCent, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Percentage of Games Played Won", 
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Percentage of Games Played Won")

ggplot(data = m_final_aug, aes(x = ageCent, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Age", 
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Age")

ggplot(data = m_final_aug, aes(x = active_twitter_lyear, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Whether The Player Had An Active Twitter Account In 2015-2016", 
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Having An Active Twitter Account Last Year")
```

There looks to be a pattern in the plot because towards the end it curves upward drastically. Therefore, this pattern suggests that interactions or higher-order terms (like quadratic terms) are required. Thus, linearity is not satisfied.

There looks to be a pattern in the plot because towards the end it also curves upward drastically. Therefore, this pattern suggests that interactions or higher-order terms (like quadratic terms) are required. Linearity is not satisfied.

Next, we will check for the normality assumption by creating a histogram of the residuals and a normal QQ-plot of the residuals.

```{r}
nba_social_power_mod2 <- nba_social_power_mod2 %>%
  mutate(predicted = predict.lm(m_final), std_resid = rstandard(m_final))
```

```{r}
ggplot(data = nba_social_power_mod2, mapping = aes(x = std_resid)) + geom_histogram() + labs(title = "Distribution of Standardized Residuals", 
                                                                                             x = "Standardized Residuals", 
                                                                                             y = "Count")
```

Normality is violated because the histogram of residuals is heavily right skewed because the height of the graphs decreases dramatically from right to left.


```{r}
ggplot(data = nba_social_power_mod2, mapping = aes(sample = std_resid)) + 
  stat_qq() +
  stat_qq_line() +
  labs(title = "QQ Plot")
```

However, normality is not satisfied because some of the points don't follow the diagonal line. 

Lastly, we will check for independence. Data was not taken over time, so we know there is no temporal correlation. There is also no spatial correlation because data was not taken in space. We can check to see if there is some structure/order to the dataset according to observation number. There is no purposeful order to how the dataset was collected according to Kaggle, but we will check just in case:

```{r}
m_final_aug <- m_final_aug %>%
  mutate(obs_num = 1:nrow(m_final_aug))

ggplot(data = m_final_aug, aes(x = obs_num, 
                               y = .std.resid)) + 
  geom_point(alpha = 0.3) +
  labs(x = "Observation Number", 
       y = "Residuals", 
       title = "Residuals vs. Observation Number")
```

Looking at the graph, there is no distinguishable pattern in the graph. The number of Twitter followers of one player will not affect the number of Twitter followers of another player. Therefore, independence is satisfied.

Therefore, because constant variance and normality and linearity are not satisfied, but independence is, we will make some adjustments to our model. We can adjust for linearity by adding squared terms for salary and percentage of games played won because those standardized residuals vs. predictor variable plots violated linearity. For constant variance, we can log-transform the response variable because our standardized residuals vs. predicted values violated constant variance. Lastly, for normality regression there were outliers observed in the histograms, so we can try to remove all 7 outlier players from our model as mentioned previously above because Kevin Durant, LeBron James, Josh Huestis, JaVale McGee, David West, Jarnell Stokes, and Carmelo Anthony are considered high leverage players (and hence potential influential points).

After making these adjustments our model looks like this:

```{r}
nba_social_power_mod3 <- nba_social_power_mod2 %>%
  mutate(TWITTER_FOLLOWER_COUNT_MILLIONS_LOG = log(TWITTER_FOLLOWER_COUNT_MILLIONS)) %>%
  filter(PLAYER_NAME != "Kevin Durant" & PLAYER_NAME != "Josh Huestis" & PLAYER_NAME != "JaVale McGee" & PLAYER_NAME != "David West" & PLAYER_NAME != "Jarnell Stokes" & PLAYER_NAME != "Carmelo Anthony")

m_final_adjust1 <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS_LOG ~ salary_millionsCent 
                     + I(salary_millionsCent * salary_millionsCent)
                     + w_pctCent 
                 + I(w_pctCent * w_pctCent)
                 + salary_millionsCent * w_pctCent,
               data = nba_social_power_mod3)

tidy(m_final_adjust1, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

However, because the interaction effect and `w_pctCent` squared terms and the `salary_millionsCent` have p-values that are very large and > 0.05, we will remove them from our model to produce this model. We will attempt to see if the log transformation of our response variable is enough to support our assumptions.

```{r}
m_final_adjust2 <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS_LOG ~ salary_millionsCent 
                     + w_pctCent,
               data = nba_social_power_mod3)

tidy(m_final_adjust2, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

We will check for all assumptions again:

First, we will check for linearity and whether the response variable has a linear relationship with the predictor variables in the model. We will check the plot of standardized residuals vs. predicted values:

```{r}
m_final_adj_aug <- augment(m_final_adjust2)
ggplot(data = m_final_adj_aug, aes(x = .fitted, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Predicted", 
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Predicted")
```

When observing for constant variance, the height of the cloud of points seems to be constant as you move from left to right. Therefore, constant variance is satisfied.

There is no obvious pattern and the shape of the graph seems to be linear. Hence, this plot presents no issues with the linearity assumption. 

Next, we will observe the plot of residuals vs. predictors: 

```{r}
ggplot(data = m_final_adj_aug, aes(x = salary_millionsCent, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Salary (Millions)",
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Salary (Millions)")
```

There is no distinguishable pattern in our plot because there are no discernible curves. Therefore, we satisfy linearity.

```{r}
ggplot(data = m_final_adj_aug, aes(x = w_pctCent, y = .std.resid)) +
  geom_point(alpha = 0.5) + 
  geom_hline(yintercept = 0, color = "red") +
  labs(x = "Percentage of Games Played Won",
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Percentage of Games Played Won")

```

There looks to be no distinguishable pattern in the plot as well, so therefore linearity is supported because there have been previous violations of linearity.

Next, we will check for the normality assumption by creating a histogram of the residuals and a normal QQ-plot of the residuals.

```{r}
nba_social_power_mod3 <- nba_social_power_mod3 %>%
  mutate(predicted = predict.lm(m_final_adjust2),
         std_resid = rstandard(m_final_adjust2))
```

```{r}
ggplot(data = nba_social_power_mod3, mapping = aes(x = std_resid)) + geom_histogram() + labs(title = "Distribution of Standardized Residuals",
                                                                                         x = "Standardized Residuals",
                                                                                         y = "Count")

```

Normality is not supported because the histogram of residuals is not normal and is now slightly left skewed because the height increases as you move across the graph, then drastically decreases, but the distribution is unimodal. 

```{r}
ggplot(data = nba_social_power_mod2, mapping = aes(sample = std_resid)) +
  stat_qq() +
  stat_qq_line() +
  labs(title = "QQ Plot")
```

However, normality is not satisfied because some of the points don't follow the diagonal line. 

Lastly, we will check for independence. Data was not taken over time, so we know there is no temporal correlation. There is also no spatial correlation because data was not taken in space. We can check to see if there is some structure/order to the dataset according to observation number. There is no purposeful order the data was collected in according to Kaggle, but we will check just in case:

```{r}
m_final_adj_aug <- m_final_adj_aug %>%
  mutate(obs_num = 1:nrow(m_final_adj_aug))

ggplot(data = m_final_aug, aes(x = obs_num,
                               y = .std.resid)) + 
  geom_point(alpha = 0.3) +
  labs(x = "Observation Number",
       y = "Standardized Residuals", 
       title = "Standardized Residuals vs. Observation Number")
```

Looking at the graph, there is no distinguishable pattern in the graph. The number of Twitter followers of one player will not affect the number of Twitter followers of another player. Therefore, independence is satisfied.

Linearity, constant variance, and normality are all satisfied in this model. We have done everything we can to the best of our knowledge to fix normality, so we will continue on with this model for interpretations. Our final model output is:

```{r}
tidy(m_final_adjust2, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

`log(TWITTER_FOLLOWER_COUNT_MILLIONS)`-hat = -1.398 + 0.133 * `salary_millionsCent` + 2.336 * `w_pctCent`.

The p-values for each of these predictor variables are all < 0.05, so we know each of the predictor variables is a significant predictor for our response variable.

Lastly, we will also check for multicollinearity in our model. If two or more predictor variables are highly correlated in our model, our regression may change eratically in response to small changes in our data. 

We will check the variance inflation factor (VIF) for every predictor variable to check for concerns with multicollinearity:

```{r vif}
tidy(vif(m_final_adjust2))
```

None of the variables have VIFs greater than or equal to 10, so there are no issues with multicollinearity.

### Section 3: Discussion

### Interpretations

``` {r display-model-again}
tidy(m_final_adjust2, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)

nba_social_power_mod %>%
  summarise(mean_salary = mean(SALARY_MILLIONS),
            mean_winpct = mean(W_PCT))
```

Again, the final model is displayed above. Its equation is: `log(TWITTER_FOLLOWER_COUNT_MILLIONS)`-hat = -1.398 + 0.133 * `salary_millionsCent` + 2.336 * `w_pctCent`.

The intercept of the model is -1.398, which means that a player with a salary of 11.3 million dollars (average salary) and win percentage of 0.511 (average win percentage) are expected to have exp(-1.398) million, or approximately 247,090.7, Twitter followers.

The coefficient of `salary_millionsCent` is 0.133, which means that, for every 1 million increase in player salary, a player's Twitter followers are expected to multiply by a factor of exp(0.133) = 1.142, holding all else constant.

The coefficient of `w_pctCent` is 2.336. This coefficient is misleading, as an increase of 1 in win percent is only possible if a team has 0 wins. So, this coefficient is better explained by every 0.1 increase in team win percentage, a player's Twitter followers are expected to multiply by a factor of exp(0.2336) = 1.263, holding all else constant.

Interpreting coefficients is not particularly important, however, as our objective is to predict Twitter followers.

### Predictions

We have carefully selected 3 players from the 2016-2017 season who are not included in the dataset, and will test the model's predictive accuracy by comparing predicted Twitter follower counts to actual Twitter data from 2017. 

Salary data was taken from ESPN (www.espn.com), and win percent data was calculated from team data (stats.nba.com). The number of Twitter followers was collected from various articles written in 2017.

Derrick Rose:

`salary_millionsCent` = 21.3 - 11.3 = 10 
`w_pctCent` = 0.406 - 0.511 = -0.105

-1.398 + 0.133 * (10) + 2.336 * (-0.105) = -0.313

Derrick Rose's Twitter followers are expected to be exp(-0.313) = 731,249.9 followers. He actually had 2.49 million Twitter followers, so this is an extreme underprediction.

Wesley Matthews:

`salary_millionsCent` = 17.1 - 11.3 = 5.8 
`w_pctCent` = 0.397 - 0.511 = -0.114

-1.398 + 0.133 * (5.8) + 2.336 * (-0.114) = -0.893

Wesley Matthews's Twitter followers are expected to be exp(-0.893) = 409,425.6 Twitter followers. He actually had 241,000 Twitter followers, so this is another overprediction. This might be attributed to his high salary, however, so the model overpredicts for that reason.

Boris Diaw:

`salary_millionsCent` = 7 - 11.3 = -4.3
`w_pctCent` = 0.616 - 0.511 = 0.105

-1.398 + 0.133 * (-4.3) + 2.336 * (0.105) = -1.725

Boris Diaw's Twitter followers are expected to be exp(-1.725) = 178,173.1 followers. He actually had 462,000 Twitter followers (gross underestimate). This time, his salary contributed to the underprediction.

The model has poor preditive capacity. The most likely reason this is the case is due to the large number of players on a basketball team (15) and the few stars in the NBA who have large amounts of Twitter followers (in the millions).  We would like some feedback about how to improve this by possibly adding more significant terms.

It is important to note that the dates at which these Twitter follow counts were recorded vary and do not perfectly coincide with the data collection of this dataset. However, the dataset itself only specifies that the data was collected during the 2016-2017 season, and these articles came from during the season as well.

### Section 4: Limitations

According to our dataset, five players were missing Twitter handles. These values are missing at random because the missingness depends on other observed variables (e.g. the person's social media usage). Hence, the probability that a variable is missing depends on information not included in our dataset. We decided to remove these five players from our dataset because there were very few observations with missing values relative to the sample size (after removing these players, we still had 95 observations). We also determined, since the observations with missingness are random, the resulting analysis will not be biased because the missingness does not differ systematically from the complete observations. In addition, since our objective is predicting the number of Twitter followers for NBA athletes, players without Twitter accounts are outside of the model's predictive capabilities and hence do not belong in the dataset.

One other modification we made to our original dataset was removing LeBron James. We decided, based on Cook's distance, standardized residuals, and leverage, LeBron was an influential point with a significant effect on the regression line. Because we removed LeBron, we will use standardized residuals when checking assumptions.

All in all, we completed the analysis with 94 observations, which is a sufficiently large sample population to build a model which can be generalized to a larger population of NBA athletes.

### Section 5: Conclusion

### Section 6: Additional Work


### Complete EDA: 
#### Univariate

First, we will do univariate EDA on the dataset. Player name will be used to refer to observations in our dataset, but since each player name is distinct we do not need to do EDA on the `PLAYER_NAME` variable. 

Here, we'll look into players' salaries, in millions of dollars:

```{r}
ggplot(data = nba_social_power_mod,
       aes(x = SALARY_MILLIONS)) + 
  geom_histogram(binwidth = 1) +
  labs(x = "Player Salaries, in Millions of Dollars",
       y = "Count",
       title = "Distribution of Player Salaries")

nba_social_power_mod %>%
  summarise(mean = mean(SALARY_MILLIONS),
            min= min(SALARY_MILLIONS),
            Q1 = quantile(SALARY_MILLIONS, .25),
            median = median(SALARY_MILLIONS),
            Q3 = quantile(SALARY_MILLIONS, .75),
            max = max(SALARY_MILLIONS))

nba_social_power_mod %>%
  arrange(desc(SALARY_MILLIONS)) %>%
  select(PLAYER_NAME, SALARY_MILLIONS) %>%
  head(10)
```

As we can see from the histogram, the distribution of salaries is somewhat right-skewed, with most of the players making less than 20 million dollars a year. The mean salary is 11.3 million dollars a year. The player who earns the most, at 30.96 million dollars per year, is LeBron James (LeBron could be an influential point, so we will revisit this after the model selection phase). On the other hand, Russell Westbrook, Kevin Durant, Mike Conley, DeMar DeRozan, and Al Horford each earn 26.54 million dollars per year.


Here, we'll look into the response variable, `TWITTER_FOLLOWER_COUNT_MILLIONS`:

```{r}
ggplot(data = nba_social_power_mod,
       aes(x= TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_histogram(binwidth = 2) +
  labs(x = "Twitter Followers, in Millions",
       y = "Count",
       title = "Distribution of Twitter Follower Counts")

nba_social_power_mod %>%
  summarise(mean = mean(TWITTER_FOLLOWER_COUNT_MILLIONS),
            min= min(TWITTER_FOLLOWER_COUNT_MILLIONS),
            Q1 = quantile(TWITTER_FOLLOWER_COUNT_MILLIONS, .25),
            median =   median(TWITTER_FOLLOWER_COUNT_MILLIONS),
            Q3 = quantile(TWITTER_FOLLOWER_COUNT_MILLIONS, .75),
            max = max(TWITTER_FOLLOWER_COUNT_MILLIONS))

nba_social_power_mod %>%
  arrange(desc(TWITTER_FOLLOWER_COUNT_MILLIONS)) %>%
  head(2)
```

From the histogram, we can see that the distribution of Twitter follower counts is extremely right-skewed. The number of Twitter followers ranges from .002 million to 37 million, with a mean of 1.6 million and a median of.246 million. There are two obvious outliers: Kevin Durant, with 16.2 million followers, and LeBron James, with 37 million followers. 


Here, we'll take a look at how many players there are from each team in the dataset: 

```{r}
nba_social_power_mod %>%
  count(TEAM_ABBREVIATION) %>%
  arrange(n)
```

As we can see from the output, there is only one team that is represented just once in the dataset: SAC, the Sacramento Kings. The greatest number of times teams are represented in the dataset is 5. GSW (Golden State Warriors), LAC (Los Angeles Clippers), and SAS (San Antonio Spurs) are all represented 5 times. 

Now, we'll explore the distribution of the `AGE` variable in the dataset:

```{r}
ggplot(data = nba_social_power_mod, aes(x= AGE)) + 
  geom_histogram(binwidth = 1) +
  labs(x = "Age", y = "Count", title = "Distribution of Age")

nba_social_power_mod %>%
  summarise(mean = mean(AGE), min= min(AGE), Q1 = quantile(AGE, .25), median = median(AGE), 
            Q3 = quantile(AGE, .75),
            max = max(AGE))

nba_social_power_mod %>%
  arrange(desc(AGE)) %>%
  head(1)
```

As we can see from the histogram, age is somewhat normally distributed in the dataset, with a mode around 27 and a surprisingly low number of 30-year olds. The mean age, 27.39, and median age, 27, are very close together, indicating little skew. The lowest age is 20 and the highest is 39. The oldest player by far, at 39, is Dirk Nowitzki.

Now, we'll examine the distribution of win percent, `W_PCT`:

```{r}
ggplot(data = nba_social_power_mod, aes(x= W_PCT)) + 
  geom_histogram(binwidth = .05) +
  labs(x = "Win Percent", y = "Count", title = "Distribution of Win Percent")

nba_social_power_mod %>%
  summarise(mean = mean(W_PCT), min= min(W_PCT), Q1 = quantile(W_PCT, .25),
            median = median(W_PCT), Q3 = quantile(W_PCT, .75),
            max = max(W_PCT))
```

As we can see from the histogram, win percent is also somewhat normally distributed, with a mode around 50 percent. The minimum win percent in the dataset is 0, while the maximum is 82.4. The median of 50.7 is very similar to the mean of 51%. The fact that the mean and median win percents in the dataset fall so close to 50% indicate good randomness in the dataset, b/c the mean and median win percents for all nba players are 50%. 

Next, we'll look at the distributions for offensive rating, `OFF_RATING` and defensive rating `DEF_RATING`:

```{r}
ggplot(data = nba_social_power_mod, aes(x= OFF_RATING)) + 
  geom_histogram(binwidth = 1) +
  labs(x = "Offensive Rating", y = "Count",
       title = "Distribution of Offensive Rating")

nba_social_power_mod %>%
  summarise(min= min(OFF_RATING), median = median(OFF_RATING),
            max = max(OFF_RATING))
```

```{r}
ggplot(data = nba_social_power_mod, aes(x= DEF_RATING)) + 
  geom_histogram(binwidth = 1) +
  labs(x = "Defensive Rating", y = "Count",
       title = "Distribution of Defensive Rating")

nba_social_power_mod %>%
  summarise(min= min(DEF_RATING), median = median(DEF_RATING),
            max = max(DEF_RATING))
```

Defensive rating, offensive rating, and net rating do not stray far from normally distributed. Offensive rating varies from 86.8	to 124.2, with a median of 107.6. Defensive rating varies from 93 to	118.3, with a median of 106. Thus, the dataset contains a larger range in terms of offensive rating, and the median is also slightly higher for defensive rated players. The distribution of net rating has multiple nearly equal modes around -2 to -3 and around 1 and 3. The median net rating is 1.5, and the net ratings in the dataset vary from -17.2 to 18.7.

Next, we'll look at the distribution of the assist-to-turnovers ratio, `AST_RATIO`:

```{r}
ggplot(data = nba_social_power_mod, aes(x= AST_RATIO)) + 
  geom_histogram(binwidth = 3) +
  labs(x = "Assist-Turnover Ratio", y = "Count",
       title = "Distribution of Assist-Turnover Ratio")

nba_social_power_mod %>%
  summarise(mean = mean(AST_RATIO),
            min= min(AST_RATIO),
            Q1 = quantile(AST_RATIO, .25),
            median = median(AST_RATIO),
            Q3 = quantile(AST_RATIO, .75),
            max = max(AST_RATIO))

nba_social_power_mod %>%
  arrange(desc(AST_RATIO)) %>%
  head(2)
```

As we can see from the histogram, the assist-turnover ratio is very right skewed. The mode is at around 10, even though the median is at 15, and the mean is 17.12526, all of which are summary statistics that emphasize the right skew. This means that while most players in the dataset had a very high assist-turnover ratio (meaning they had many more assists than turnovers), there is a wider variation among players with a high ratio and the players with lower ratios are concentrated around a few numbers. The dataset minimum ratio of 4 means that there were no players with more turnovers than assists. Notably, this is the first variable we've examined so far with a significantly non-normal distribution. The two players with very high assist-turnover ratios, 51.5 and 41.3, are Jarnell Stokes and Ricky Rubio, respectively. 

Next, we'll examine the variation of `REB_PCT`, the percent of rebounds a player makes:

```{r}
ggplot(data = nba_social_power_mod, aes(x= REB_PCT)) + 
  geom_histogram(binwidth = .01) +
  labs(x = "Rebound Percentage", y = "Count",
       title = "Distribution of Rebound Percentage")

nba_social_power_mod %>%
  summarise(mean = mean(REB_PCT),
            min= min(REB_PCT),
            Q1 = quantile(REB_PCT, .25),
            median = median(REB_PCT),
            Q3 = quantile(REB_PCT, .75),
            max = max(REB_PCT))
```

The distribution of rebound percentage has a minimum of 0.045	and a maximum of 0.252. The distribution is not very skewed one way or another, as supported by the similar mean of .133 and median of .127. However, the distribution is not normal in that it does not resemble a bell curve; with exceptions, the data is somewhat evenly distributed from the minimum to near the maximum (although there is some trail-off towards the right side of the distribution). This non-normal spread is likely partially an indication of the fact that the dataset contains both offensive and defensive players, because whether a player is on offense or defense has a significant effect on their rebound percentage.

Next, we'll look at `USG_PCT`, usage percentage, which is an estimate of how often a player makes team plays:

```{r}
ggplot(data = nba_social_power_mod, aes(x= USG_PCT)) + 
  geom_histogram(binwidth = .01) +
  labs(x = "Usage Percentage", y = "Count",
       title = "Distribution of Usage Percentage")

nba_social_power_mod %>%
  summarise(mean = mean(USG_PCT),
            min= min(USG_PCT),
            Q1 = quantile(USG_PCT, .25),
            median = median(USG_PCT),
            Q3 = quantile(USG_PCT, .75),
            max = max(USG_PCT))

nba_social_power_mod %>%
  arrange(desc(USG_PCT)) %>%
  head(1)
```

The distribution of usage percentage, with a minimum of .101 and a maximum of .408, is fairly normally distributed. The mean, .238, and median, .242, are similar. The fairly wide spread may indicate that the dataset contains a decent sampling of players- some 'star player' types and others that are not the centerpieces of their teams.The maximum of .408, while perhaps not quite an outlier, is separated from most of the other points; this usage percentage belongs to Russell Westbrook.

Next, we'll examine `PIE`, player impact factor, a statistic roughly measuring a player's impact on the games that they play that's used by nba.com:

```{r}
ggplot(data = nba_social_power_mod, aes(x= PIE)) + 
  geom_histogram(binwidth = .01) +
  labs(x = "Player Impact Factor", y = "Count",
       title = "Player Impact Factor Distribution")

nba_social_power_mod %>%
  summarise(mean = mean(PIE),
            min= min(PIE),
            Q1 = quantile(PIE, .25),
            median = median(PIE),
            Q3 = quantile(PIE, .75),
            max = max(PIE))

nba_social_power_mod %>%
  arrange(desc(PIE)) %>%
  select(PLAYER_NAME, PIE) %>%
  head(10)
```

As we can see from the histogram, the player impact factor, with a minimum of .112 and a maximum of .23, is quite right-skewed. The median player impact factor is .131, and the mean is .139, evidence of the right skew. The mode is around the median. The maximum, .23, is a significant outlier, and is that of Russell Westbrook, the same player who had by far the highest usage percentage; clearly, his data will need to be examined more closely later to see if it ultimately affects our model. 

Next, we'll look at average points scored per game: 

```{r}
ggplot(data = nba_social_power_mod, aes(x= PTS)) + 
  geom_histogram(binwidth = 2) +
  labs(x = "Average Points Scored Per Game",
       y = "Count",
       title = "Distribution of Average Points Scored Per Game")

nba_social_power_mod %>%
  summarise(mean = mean(PTS),
            min= min(PTS),
            Q1 = quantile(PTS, .25),
            median = median(PTS),
            Q3 = quantile(PTS, .75),
            max = max(PTS))
```

As we can see from the histogram, the distribution of average points scored is slightly normal, with some obvious departures from normality. The median number of points scored per game is 14.6, and the mean is 15.28232. The maximum is 31.6, but this does not seem to be an obvious outlier. 

Next, we'll examine the variable `ACTIVE_TWITTER_LAST_YEAR`, which tells us whether or not each player posted on Twitter the year before the data was collected:

```{r}
nba_social_power_mod <- nba_social_power_mod %>%
  mutate(ACTIVE_TWITTER_LAST_YEAR = as.factor(ACTIVE_TWITTER_LAST_YEAR))

nba_social_power_mod %>%
  count(ACTIVE_TWITTER_LAST_YEAR)
```

Out of the 95 players in our modified dataset, 2 were not active on Twitter the year before the data was collected and and 93 were. 

Next, we'll examine the variable `FGA`, field goals attempted. 

```{r}
ggplot(data = nba_social_power_mod, aes(x= FGA)) + 
  geom_histogram(binwidth = 100) +
  labs(x = "Field Goals Attempted",
       y = "Count",
       title = "Distribution of Field Goals Attempted")

nba_social_power_mod %>%
  summarise(mean = mean(FGA),
            min= min(FGA),
            Q1 = quantile(FGA, .25),
            median = median(FGA),
            Q3 = quantile(FGA, .75),
            max = max(FGA))

nba_social_power_mod %>%
  arrange(desc(FGA)) %>%
  select(PLAYER_NAME, FGA) %>%
  head(1)
```

The distribution of field goals attempted is non-normal but does not have a particular skew in either direction. Since this is a cumulative measure, it likely largely depends on a player's position and the amount of playing time they have had in NBA games. The outlier, at 1941 field goals attempted, is Russell Westbrook. This variable varies between 1 and 1941 field goals attempted, with a median of 785 and a mean of 785.27. 

Now, I'll look at the distribution of field goals made. 

```{r}
ggplot(data = nba_social_power_mod, aes(x= FGM)) + 
  geom_histogram(binwidth = 100) +
  labs(x = "Field Goals Made",
       y = "Count",
       title = "Distribution of Field Goals Made")

nba_social_power_mod %>%
  summarise(mean = mean(FGM),
            min= min(FGM),
            Q1 = quantile(FGM, .25),
            median = median(FGM),
            Q3 = quantile(FGM, .75),
            max = max(FGM))

nba_social_power_mod %>%
  arrange(desc(FGM)) %>%
  select(PLAYER_NAME, FGM) %>%
  head(1)
```

The distribution of field goals made is somewhat normal, with a mean of 379.8 and a median of 392 showing a slight right skew. The minimum is 1 and the maximum is 824, by Russell Westbrook.

#### Bivariate

Next, we will do bivariate EDA, looking into the relationships of some of the predictor variables with the response variables. We won't do bivariate EDA on player name, Twitter handle, age, team abbreviation, or whether the players were active on Twitter last year, instead focusing on terms we believe may play a more nuanced / important role in predicting Twitter followers.

First, we'll look for a relationship between win percent and Twitter followers in millions:

```{r}
ggplot(nba_social_power_mod, aes(x = W_PCT, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Win Percent and Twitter Follower Count", 
       x = "Win Percent", y = "Twitter Follower Count, in Millions")
```

From the above plot, we can see that win percent and Twitter follower count may have a very weak positive  orrelations. The players with significantly higher-than-average Twitter follower counts tend to have higher win percentages; however, this relationship is very weak. 

Next, we'll examine whether there is a relationship between usage percentage and Twitter follower count:

```{r}
ggplot(nba_social_power_mod,
       aes(x = USG_PCT,
           y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Usage Percentage and Twitter Follower Count",
       x = "Usage Percentage",
       y = "Twitter Follower Count, in Millions")
```

There appears to be a very weak positive correlation between usage percentage and Twitter follower count; players with a high usage percentage tend to have more Twitter followers, on average, than those with a lower usage percentage. 

Next, we'll examine whether there is a relationship between player impact factor and Twitter follower count:

```{r}
ggplot(nba_social_power_mod, 
       aes(x = PIE, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Player Impact Factor and Twitter Follower Count",
       x = "Player Impact Factor",
       y = "Twitter Follower Count, in Millions")
```

There appears to be a  somewhat positive correlation between player impact factor and Twitter follower count; players with a high player impact factor tend to have more Twitter followers, on average, than those with a lower player impact factor. 

Now, we'll look for a relationship between average points scored per game and Twitter follower count:

```{r}
ggplot(nba_social_power_mod,
       aes(x = PTS, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Avg. Points Scored and Twitter Follower Count",
       x = "Avg. Points Scored",
       y = "Twitter Follower Count, in Millions")
```

There appears to be a weak positive correlation between average points scored and Twitter follower count; players with higher avg. points scored tend to have more Twitter followers than those with lower avg. points scored. 

Finally, we'll look for a relationship between player salaries and points scored:

```{r}
ggplot(nba_social_power_mod, aes(x = SALARY_MILLIONS, y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Player Salaries and Twitter Follower Count",
       x = "Salary, in Millions of Dollars",
       y = "Twitter Follower Count, in Millions")
```

There appears to be a positive correlation between salary and Twitter follower count; the players with higher salaries tend to have higher Twitter follower counts. 

Here, we'll look at the relationship between assist-to-turnovers ratio and Twitter follower count:

```{r}
ggplot(nba_social_power_mod, 
       aes(x = AST_RATIO,
           y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Assist-Turnover Ratio and Twitter Follower Count", 
       x = "Assist-Turnover Ratio",
       y = "Twitter Follower Count, in Millions")
```

There is no evident relationship between assist-turnover ratio and Twitter follower count. 

Next, we'll examine whether there is a relationship between rebound percentage and Twitter follower count:

```{r}
ggplot(nba_social_power_mod, 
       aes(x = REB_PCT,
           y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Relationship Between Rebound Percentage and Twitter Follower Count",
       x = "Rebound Percentage",
       y = "Twitter Follower Count, in Millions")
```

There is no evident relationship between rebound percentage and Twitter follower count. 

Now, I'll look for a relationship between field goals attempted and Twitter follower count as well as between field goals made and Twitter follower count. 

```{r}
p1 <- ggplot(nba_social_power_mod, 
       aes(x = FGA,
           y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Field Goals Attempted vs. Twitter Count" ,
       x = "Field Goals Attempted",
       y = "Twitter Follower Count, Millions")

p2 <- ggplot(nba_social_power_mod, 
       aes(x = FGM,
           y = TWITTER_FOLLOWER_COUNT_MILLIONS)) + 
  geom_point() + 
  labs(title = "Field Goals Made vs. Twitter Count",
       x = "Field Goals Made",
       y = "Twitter Follower Count, Millions")
```

```{r}
p1 + p2
```


### Multivariate Data Analysis

Now, we'll do some multivariate analysis. In this section, we are looking for predictor variables that may affect the way other predictor variables relate to the response variable. 

First, we'll look to see if points scored affects the way player impact factor (PIE) relates to Twitter follower count: 

```{r}
nba_social_power_mod1 <- nba_social_power_mod %>%
  mutate(PTS_CAT = case_when(
    PTS <= 15 ~ "0-15" , 
    PTS > 15 ~ "more than 15"
  ))
```

```{r}
ggplot(data = nba_social_power_mod1,
       aes(x = PIE, 
           y = TWITTER_FOLLOWER_COUNT_MILLIONS,
           color = PTS_CAT)) +
         geom_point() + 
  labs(x = "Player Impact Factor",
       y= "Twitter Follower Count, in Millions", 
       color = "Avg. Points Scored per Game",
       title = "Relationship Between Pts Scored, Twitter Followers, and Player Impact Factor")
```

As we can see from the above color-coded boxplot, many of the players with the most points scored have higher player impact factors, and player impact factor values have a weak positive correlation with the Twitter follower count. This could be an opportunity for an interaction term. 

Next, we'll try to determine whether win percentage affects the way salary relates to the Twitter follower count:

```{r}
nba_social_power_mod1 <- nba_social_power_mod %>%
  mutate(W_PCT_CAT = case_when(
    W_PCT <= .5 ~ "less than half" , 
    W_PCT > .5 ~ "more than half"
  ))
```

```{r}
ggplot(data = nba_social_power_mod1, 
       aes(x = SALARY_MILLIONS, 
           y = TWITTER_FOLLOWER_COUNT_MILLIONS,
           color = W_PCT_CAT)) +
         geom_point() + 
  labs(x = "Salary, in Millions",
       y = "Twitter Follower Count, in Millions", 
       color = "Proportion of Games Won",
       title = "Relationship Between Win Percentage,
       Twitter Followers, and Salary")
```

As we can see from the scatterplot, players with higher win percentages tend to be paid more, and high salary has a weak positive correlation with the Twitter follower count. This could also be an opportunity for an interaction term. 



### Initial Model

First, we fit a model with thirteen main effect terms --mean-centered age, mean-centered assists-to-turnovers ratio, mean-centered player offensive rating, mean-centered player defensive rating, mean-centered player impact factor (PIE), mean-centered rebound percentage, mean-centered usage percentage, mean-centered salary, mean-centered win percentage, mean-centered points scored, mean-centered field goals made, mean-centered field goals attempted, and whether the player has an active Twitter account in 2015-2016-- and also considered interactions between mean-centered salary and mean-centered win percentage and mean-centered player impact factor (PIE) and mean-centered points scored:

```{r first-model}
m1 <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS ~ ageCent +
           ast_ratioCent +
           off_ratingCent +
           def_ratingCent +
           PIECent +
           reb_pctCent +
           usg_pctCent +
           salary_millionsCent +
           w_pctCent +
           ptsCent +
           fgmCent +
           fgaCent +
           active_twitter_lyear +
           salary_millionsCent * w_pctCent +
           PIECent * ptsCent,
         data = nba_social_power_mod)
tidy(m1, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

### Backward Selection (Iteration 1)

We will now perform the first iteration of backward selection using AIC as the selection criterion:

```{r backward-selection-1}
m1_aic <- step(m1, direction = "backward")

tidy(m1_aic, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

Based on the output displayed above from the first iteration of backward selection (using AIC as the selection criterion), five main effect terms (mean-centered player offensive rating, mean-centered player defensive rating, mean-centered player impact factor, mean-centered rebound percentage, and mean-centered points scored) and the interaction between mean-centered player impact factor and mean-centered points scored were removed.

However, three terms in the selected model -- mean-centered assists-to-turnovers ratio, mean-centered win percentage, and whether the player had an active Twitter account in 2015-2016 -- have high p-values, 0.102, 0.106, and 0.087 respectively. Furthermore, the confidence intervals for these slope coefficients, [-0.016, 0.171], [-0.954, 9.807] and [-0.657, 9.413] respectively, include zero. Mean-centered win percentage will need to remain in the model to keep the statistically significant interaction between mean-centered salary and mean-centered win percentage. But, we can reasonably infer mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016 may be a particularly troublesome predictors in the model. 

We will proceed with the second iteration of backward selection and will revisit the issue of these troublesome predictors after viewing the selected linear regression model based on adjusted R-squared.

### Backward Selection (Iteration 2)

Next, we will perform the second iteration of backward selection using adjusted R-squared as the selection criterion:

```{r backward-selection-2}
m1_adjR <- regsubsets(TWITTER_FOLLOWER_COUNT_MILLIONS ~ ageCent +
           ast_ratioCent +
           off_ratingCent +
           def_ratingCent +
           PIECent +
           reb_pctCent +
           usg_pctCent +
           salary_millionsCent +
           w_pctCent +
           ptsCent +
           fgmCent +
           fgaCent +
           active_twitter_lyear +
           salary_millionsCent * w_pctCent +
           PIECent * ptsCent,
         data = nba_social_power_mod,
         method = "backward")

select_summary <- summary(m1_adjR)
coef(m1_adjR, which.max(select_summary$adjr2))
```

Based on the output displayed above from the second iteration of backward selection (using adjusted R-squared as the selection criterion), six main effect terms (mean-centered player offensive rating, mean-centered player defensive rating, mean-centered player impact factor, mean-centered rebound percentage, mean-centered win percentage, and mean-centered points scored) and and the interaction between mean-centered player impact factor and mean-centered points scored were removed.

### Model Comparison: AIC vs. Adjusted R-squared

We noticed the model selected using AIC as the selection criterion includes an additional quantitative term (mean-centered win percentage) which was omitted in the model selected based on adjusted R-squared. 

We decided to keep mean-centered win percentage in the model so that the statistically significant interaction between mean-centered salary and mean-centered win percentage could remain in the model as well.

Then, we revisited the issue of troublesome (seemingly insignificant) predictors. Unfortunately, both selected models included mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016; thus, we had to decide whether to keep the variables in the model, or to ignore the results from the two iterations of backward selection and remove them.

To answer this question, we compared the AIC and adjusted R-squared values for the model selected based on AIC as the selection criterion (first iteration) and the same model without mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016:

```{r include-all}
m1_modV1 <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS ~
                 ageCent +
                 ast_ratioCent +
                 usg_pctCent +
                 salary_millionsCent +
                 w_pctCent +
                 fgmCent +
                 fgaCent +
                 active_twitter_lyear +
                 salary_millionsCent * w_pctCent,
               data = nba_social_power_mod)
```

```{r exclude-insignificant-terms}
m1_modV2 <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS ~
                 ageCent +
                 usg_pctCent +
                 salary_millionsCent +
                 w_pctCent +
                 fgmCent +
                 fgaCent +                
                 salary_millionsCent * w_pctCent,
               data = nba_social_power_mod)
```

```{r AIC-adjR-include-all}
glance(m1_modV1)$AIC
glance(m1_modV1)$adj.r.squared
```

```{r AIC-adjR-exclude-insignificant-terms}
glance(m1_modV2)$AIC
glance(m1_modV2)$adj.r.squared
```

Based on the above output, the AIC of the model with all terms is roughly 517.76. Conversely, the AIC of the model without the statistically insignificant terms is roughly 519.88.

Moreover, the adjusted R-squared value for the model with all terms is roughly 0.388, whereas the adjusted R-squared value for the model without the statistically insignificant terms is about 0.363. 

Therefore, the model with all terms maximizes adjusted R-squared and minimizes AIC. Since adjusted R-squared penalizes for unnecessary predictors, the fact that the model with all terms had a higher adjusted R-squared value means that, despite the high p-values and the presence of zero in the confidence intervals associated with mean-centered assists-to-turnovers ratio and whether the player had an active Twitter account in 2015-2016, we can conclude these predictors are valuable in predicting the response, the number of Twitter followers (in millions).

### Impact of Prominent Players

Lastly, before discussing assumptions, we examined the impact of including versus excluding prominent athletes in our model. Since he is widely regarded as one of the best NBA players of all-time, we used LeBron James as a case study for preliminary analysis:

```{r prominent-athletes}
nba_social_power_mod %>%
  arrange(desc(SALARY_MILLIONS)) %>%
  select(PLAYER_NAME, SALARY_MILLIONS) %>%
  head(10)

nba_social_power_mod %>%
  arrange(desc(TWITTER_FOLLOWER_COUNT_MILLIONS)) %>%
  select(PLAYER_NAME, TWITTER_FOLLOWER_COUNT_MILLIONS) %>%
  head(10)
```

Based on the tables above, it is seems like LeBron James is an outlier, both in regard to his annual salary and Twitter follower count. So, we will remove LeBron from the dataset and see how the model changes:

```{r removing-LeBron}
nba_social_power_mod2 <- nba_social_power_mod %>%
  filter(PLAYER_NAME != "LeBron James")

glimpse(nba_social_power_mod2)
```

Based on the above output, we can see LeBron has been removed from the dataset (94 observations remaining).

Now, to assess the impact of his absence on the final model:

```{r model-without-LeBron}
m_final_noLJ <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS ~
                 ageCent +
                 ast_ratioCent +
                 usg_pctCent +
                 salary_millionsCent +
                 w_pctCent +
                 fgmCent +
                 fgaCent +
                 active_twitter_lyear +
                 salary_millionsCent * w_pctCent,
               data = nba_social_power_mod2)

tidy(m_final_noLJ, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

```{r LeBron-relative-usage-percentage}
nba_social_power_mod %>%
  arrange(desc(USG_PCT)) %>%
  select(PLAYER_NAME, USG_PCT) %>%
  head(15)
```

```{r LeBron-relative-FGM}
nba_social_power_mod %>%
  arrange(desc(FGM)) %>%
  select(PLAYER_NAME, FGM) %>%
  head(5)
```

```{r LeBron-relative-FGA}
nba_social_power_mod %>%
  arrange(desc(FGA)) %>%
  select(PLAYER_NAME, FGA) %>%
  head(16)
```

Comparing the two models, we notice a relatively sizable discrepancy in the slope coefficient of mean-centered usage percentage. This makes sense since LeBron has the twelfth-highest usage percentage in the league (0.297), so eliminating him from the dataset dramatically affects the average usage percentage (as well as the spread, or standard deviation). We also see a discrepancy in the p-values for mean-centered field goals made and mean-centered field goals attempted. These predictors have become statistically insignificant without LeBron James. This also makes sense since LeBron made the fourth-most field goals (736) and attempted the sixteenth-most field goals (1344).

More generally, to determine whether prominent athletes are influential points, we will look at standardized residuals, leverage, and Cook's Distance:

```{r leverage}
augmented_data <- augment(m_final)

augmented_data <- augmented_data %>%
  mutate(obs_num = row_number())

threshold <- ((2 * (9 + 1)) / 95) 

ggplot(data = augmented_data, aes(x = obs_num, y = .hat)) + 
  geom_point() + 
  geom_hline(yintercept = threshold, color = "red") +
  labs(x = "Observation Number",
       y = "Leverage Value",
       title = "Observation Number vs. Leverage Value")

augmented_data %>%
  filter(.hat > threshold) %>%
  select(obs_num, .hat)

nba_leverage <- nba_social_power_mod %>%
  mutate(obs_num = row_number()) %>%
  filter(obs_num == 5 | obs_num == 6 | obs_num == 10 |
           obs_num == 11 | obs_num == 36 | obs_num == 75)

nba_leverage %>%
  select(obs_num, PLAYER_NAME)
```

Based on the threshold (`2 * (p + 1) / n`), Kevin Durant, LeBron James, Kawhi Leonard, Joel Embiid, Greg Monroe, and Jarnell Stokes are considered high leverage players (and hence potential influential points).

Now, to identify outliers within these candidates, we will look at the standardized residuals:

```{r standardized-residuals}
ggplot(data = augmented_data, aes(x = .fitted, y = .std.resid)) + 
  geom_point() + 
  geom_hline(yintercept = 2, color = "red") +
  geom_hline(yintercept = -2, color = "red") + 
  labs(x = "Predicted Number of Twitter Followers",
       y = "Standardized Residuals",
       title = "Standardized Residuals vs. Predicted Twitter Follower Counts")

augmented_data %>%
  filter(.std.resid > 2 | .std.resid < -2) %>%
  select(obs_num, .std.resid)

nba_std_resid <- nba_social_power_mod %>%
  mutate(obs_num = row_number()) %>%
  filter(obs_num == 6 | obs_num == 30 | obs_num == 78)

nba_std_resid %>%
  select(obs_num, PLAYER_NAME)
```

The players with standardized residuals of magnitude greater than 2 are LeBron James, DeAndre Jordan, and Carmelo Anthony. Hence, LeBron, DeAndre, and Carmelo are outliers; however, it remains to be seen whether DeAndre and Carmelo impact the regression line (we already examined LeBron's effect).

To assess the impact of prominent athletes (identified by high leverage and/or high standardized residuals) on the regression line, we examine Cook's Distance:

```{r Cooks-Distance}
ggplot(data = augmented_data, aes(x = obs_num, y = .cooksd)) + 
  geom_point(alpha = 0.3) + 
  geom_hline(yintercept = 1, color = "red") +
  labs(x = "Observation Number",
       y = "Cook's Distance",
       title = "Cook's Distance") +
  geom_text(aes(label = ifelse(.cooksd > 1, as.character(obs_num), "")))

nba_std_resid %>%
  filter(obs_num == 6) %>%
  select(obs_num, PLAYER_NAME)
```

It is clear from the plot of Cook's Distance vs. observation number that LeBron James is the only influential point.

Since our objective is to accurately predict the Twitter follower counts of NBA players, it is probably best to exclude LeBron to avoid overestimating for less prominent athletes. Hence, we will continue our analysis by using the multiple linear regression model without LeBron James.

Before finalizing this choice, we must consider the impact of LeBron's absence on the significance of certain predictors, namely mean-centered usage percentage, mean-centered field goals made, and mean-centered field goals attempted. We will perform backward selection on this new model (with adjusted slope coefficients due to the absence of LeBron James) with AIC as the selection criterion:

```{r backward-selection-3}
m_last <- step(m_final_noLJ, direction = "backward")

tidy(m_last, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

As we can see from the above output, mean-centered assists-to-turnovers ratio, mean-centered usage percentage, mean-centered field goals made, and mean-centered field goals attempted were removed. However, mean-centered age and whether the player had an active Twitter account in 2015-2016 -- insignificant predictors (based on p-values and confidence intervals) -- remain in the model. To determine whether these predictors should be removed, we compare the AIC and adjusted R-squared values for the final model selected based on AIC as the selection criterion (without LeBron) and the same model without mean-centered age and whether the player had an active Twitter account in 2015-2016:

```{r last-model-comparison}
m_last1 <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS ~
                 salary_millionsCent +
                 w_pctCent +
                 salary_millionsCent * w_pctCent,
               data = nba_social_power_mod2)

tidy(m_last1, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

```{r aic-adjR-squared}
glance(m_last)$AIC
glance(m_last)$adj.r.squared

glance(m_last1)$AIC
glance(m_last1)$adj.r.squared
```

Based on the AIC and adjusted R-squared values displayed above, the model with all terms minimized AIC (412.32) and maximized adjusted R-squared (0.318). Therefore, we proceed with the model which includes mean-centered salary, mean-centered win percentage, mean-centered age, whether the player had an active Twitter account in 2015-2016, and the interaction between mean-centered salary and mean-centered win percentage.


As we can see from the dotplots above, both field goals made and field goals attempted appear to have weak positive relationships with Twitter follower counts. 

In sum, there appear to be weak to moderate positive correlations between Twitter follower count and win percentage, usage percentage, player impact factor, avg. points per game, field goals made, field goals attempted, and player salaries; there is no obvious relationship between Twitter follower count and assist-to-turnover ratio or rebound percentage.


There may have been some slight linearity issues with our current model. Though there is not a discernible pattern in our residuals plot for salary, there was slight curvature, so we were interested to see if we could fix this with a log-transformation:

```{r}
m_final_add <- lm(TWITTER_FOLLOWER_COUNT_MILLIONS_LOG ~ log(salary_millionsCent) 
                     + w_pctCent 
                  + log(salary_millionsCent) * w_pctCent,
               data = nba_social_power_mod3)

tidy(m_final_add, conf.int = TRUE) %>%
  kable(format = "markdown", digits = 3)
```

Our p-values are extremely high for all coefficients, which means that predicted variables are  not significant predictors for the response variable. Therefore, we will not continue with this model, because our final model from before is significant and satisfies assumptions fairly well.


